{{ define "main" }}
<div class="post garden-post {{ with .Site.Params.doNotLoadAnimations }} . {{ else }} animated fadeInDown {{ end }}">
  <!-- Garden State Indicator -->
  {{ if eq .Type "garden" }}
  <div class="garden-state-indicator">
    {{ if eq .Params.state "seed" }}
    <span class="state-icon seed" title="Seed - New Growth">ðŸŒ±</span>
    {{ else if eq .Params.state "sprout" }}
    <span class="state-icon sprout" title="Sprout - Developing Ideas">ðŸŒ¿</span>
    {{ else if eq .Params.state "rhizome" }}
    <span class="state-icon rhizome" title="Rhizome - Mature, Connected Ideas">ðŸ«š</span>
    {{ else }}
    <span class="state-icon seed" title="Seed - New Growth">ðŸŒ±</span>
    {{ end }}
    <span class="state-label">{{ default "seed" .Params.state }}</span>
    <span class="state-dates">
      <time class="planted">Planted: {{ .Date.Format "January 2, 2006" }}</time>
      {{ if .Params.updated }}
      {{ $dateStr := .Params.updated }}
      {{ $dateParts := split $dateStr " " }}
      {{ if ge (len $dateParts) 2 }}
      {{ $justDate := index $dateParts 0 }}
      <time class="tended">Last tended: {{ dateFormat "January 2, 2006" $justDate }}</time>
      {{ end }}
      {{ end }}
    </span>
  </div>
  {{ end }}

  <div class="post__content">
    {{ .Content }}
  </div>

  <!-- Related Content for Garden Pages -->
  {{ if eq .Type "garden" }}
  {{ $related := .Site.RegularPages.Related . | first 6 }}
  {{ $gardenRelated := where $related "Type" "garden" }}
  {{ if $gardenRelated }}
  <div class="garden-related">
    <h3 class="related-heading">ðŸŒ¿ Related Growth</h3>
    <div class="related-grid">
      {{ range $gardenRelated }}
      <a href="{{ .RelPermalink }}" class="related-card">
        <span class="related-icon {{ .Params.state }}">
          {{ if eq .Params.state "seed" }}ðŸŒ±{{ else if eq .Params.state "sprout" }}ðŸŒ¿{{ else }}ðŸ«š{{ end }}
        </span>
        <div class="related-content">
          <h4 class="related-title">{{ .Title }}</h4>
          {{ if .Summary }}
          <p class="related-summary">{{ .Summary | plainify | truncate 80 }}</p>
          {{ end }}
        </div>
      </a>
      {{ end }}
    </div>
  </div>
  {{ end }}
  {{ end }}

  <!-- Garden Callout - Added INSIDE the post container but AFTER the content -->
  {{ if eq .Type "garden" }}
  <div class="garden-callout">
    <p>This is an entry in my digital garden. <a href="{{ .Site.BaseURL }}garden">See what else is growing here.</a></p>
  </div>
  {{ end }}
</div>

<!-- Add CSS for garden state indicator -->
{{ if eq .Type "garden" }}
<style>
  .garden-post {
    position: relative;
  }

  .garden-state-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    padding: 0.75rem 1rem;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.05);
    border-left: 4px solid;
  }

  /* State-specific styling */
  .garden-state-indicator:has(.seed) {
    border-left-color: rgba(145, 219, 105, 0.8);
    background: rgba(145, 219, 105, 0.05);
  }

  .garden-state-indicator:has(.sprout) {
    border-left-color: rgba(72, 187, 120, 0.8);
    background: rgba(72, 187, 120, 0.05);
  }

  .garden-state-indicator:has(.rhizome) {
    border-left-color: rgba(47, 133, 90, 0.8);
    background: rgba(47, 133, 90, 0.05);
  }

  .state-icon {
    font-size: 1.5rem;
    margin-right: 0.5rem;
  }

  .state-label {
    text-transform: capitalize;
    font-weight: 500;
    margin-right: 1rem;
  }

  .state-dates {
    display: flex;
    gap: 3rem;
    margin-left: auto;
    font-size: 1.2rem;
    opacity: 0.8;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .garden-state-indicator {
      flex-direction: column;
      align-items: flex-start;
    }

    .state-dates {
      margin-left: 0;
      flex-direction: column;
      gap: 0.25rem;
      margin-top: 0.5rem;
    }
  }

  /* Garden Related Content */
  .garden-related {
    margin: 3rem 0 2rem;
    padding: 2rem 0;
    border-top: 2px solid rgba(72, 187, 120, 0.2);
  }

  .related-heading {
    margin: 0 0 1.5rem;
    font-size: 1.6rem;
    color: rgba(72, 187, 120, 0.9);
    font-weight: 600;
  }

  .related-grid {
    display: grid;
    gap: 1rem;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }

  .related-card {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 8px;
    text-decoration: none;
    color: inherit;
    transition: all 0.25s ease;
  }

  .related-card:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(72, 187, 120, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .related-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
    opacity: 0.8;
  }

  .related-content {
    flex: 1;
    min-width: 0;
  }

  .related-title {
    margin: 0 0 0.5rem;
    font-size: 1rem;
    font-weight: 600;
    line-height: 1.3;
  }

  .related-summary {
    margin: 0;
    font-size: 0.85rem;
    line-height: 1.4;
    opacity: 0.7;
  }

  /* Garden Callout Styles */
  .garden-callout {
    margin: 2rem 0 1.5rem 0;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border-left: 4px solid rgba(72, 187, 120, 0.5);
    font-style: italic;
    text-align: center;
  }

  .garden-callout a {
    color: rgba(72, 187, 120, 0.9);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .garden-callout a:hover {
    text-decoration: underline;
  }

  /* Responsive for related content */
  @media (max-width: 768px) {
    .related-grid {
      grid-template-columns: 1fr;
    }

    .related-heading {
      font-size: 1.3rem;
    }
  }
</style>
{{ end }}
{{ end }}