{{ define "main" }}
<div class="post garden-post {{ with .Site.Params.doNotLoadAnimations }} . {{ else }} animated fadeInDown {{ end }}">
  <!-- Garden Breadcrumbs -->
  {{ if eq .Type "garden" }}
    {{ partial "garden-breadcrumbs.html" . }}
  {{ end }}

  <!-- Garden State Indicator (from module) -->
  {{ if eq .Type "garden" }}
    {{ partial "garden-state-indicator.html" . }}
  {{ end }}

  <div class="post__content">
    {{ .Content }}
  </div>

  <!-- Related Content for Garden Pages -->
  {{ if eq .Type "garden" }}
  {{ $related := .Site.RegularPages.Related . | first 6 }}
  {{ $gardenRelated := where $related "Type" "garden" }}
  {{ if $gardenRelated }}
  <div class="garden-related">
    <h3 class="related-heading">ðŸŒ¿ Related Growth</h3>
    <div class="related-grid">
      {{ range $gardenRelated }}
      <a href="{{ .RelPermalink }}" class="related-card">
        <span class="related-icon {{ .Params.state }}">
          {{ if eq .Params.state "seed" }}ðŸŒ±{{ else if eq .Params.state "sprout" }}ðŸŒ¿{{ else }}ðŸ«š{{ end }}
        </span>
        <div class="related-content">
          <h4 class="related-title">{{ .Title }}</h4>
          {{ if .Summary }}
          <p class="related-summary">{{ .Summary | plainify | truncate 80 }}</p>
          {{ end }}
        </div>
      </a>
      {{ end }}
    </div>
  </div>
  {{ end }}
  {{ end }}

  <!-- Garden Callout (from module) -->
  {{ if eq .Type "garden" }}
    {{ partial "garden-callout.html" . }}
  {{ end }}
</div>

<!-- Include garden CSS from module -->
{{ if eq .Type "garden" }}
  {{ $gardenCSS := resources.Get "css/garden.css" }}
  {{ if $gardenCSS }}
    {{ $gardenCSS = $gardenCSS | minify }}
    <link rel="stylesheet" href="{{ $gardenCSS.RelPermalink }}">
  {{ end }}
{{ end }}

<!-- Custom styles for related content (your custom feature) -->
{{ if eq .Type "garden" }}
<style>
  /* Garden Related Content */
  .garden-related {
    margin: 3rem 0 2rem;
    padding: 2rem 0;
    border-top: 2px solid rgba(72, 187, 120, 0.2);
  }

  .related-heading {
    margin: 0 0 1.5rem;
    font-size: 1.6rem;
    color: rgba(72, 187, 120, 0.9);
    font-weight: 600;
  }

  .related-grid {
    display: grid;
    gap: 1rem;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }

  .related-card {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 8px;
    text-decoration: none;
    color: inherit;
    transition: all 0.25s ease;
  }

  .related-card:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: rgba(72, 187, 120, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .related-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
    opacity: 0.8;
  }

  .related-content {
    flex: 1;
    min-width: 0;
  }

  .related-title {
    margin: 0 0 0.5rem;
    font-size: 1rem;
    font-weight: 600;
    line-height: 1.3;
  }

  .related-summary {
    margin: 0;
    font-size: 0.85rem;
    line-height: 1.4;
    opacity: 0.7;
  }

  /* Responsive for related content */
  @media (max-width: 768px) {
    .related-grid {
      grid-template-columns: 1fr;
    }

    .related-heading {
      font-size: 1.3rem;
    }
  }
</style>
{{ end }}
{{ end }}